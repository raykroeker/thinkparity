
################################################################################
## Inital Schema Creation
################################################################################
CreateMetaDataType:create table META_DATA_TYPE (\
	META_DATA_TYPE_ID smallint not null,\
	META_DATA_TYPE varchar(12) not null,\
	primary key (META_DATA_TYPE_ID),\
	unique (META_DATA_TYPE)\
)
CreateMetaData:create table META_DATA (\
	META_DATA_ID bigint generated by default as identity (start with 1000),\
	META_DATA_TYPE_ID smallint not null,\
	KEY varchar(64) not null,\
	VALUE varchar(255) not null,\
	primary key (META_DATA_ID),\
	foreign key (META_DATA_TYPE_ID) references META_DATA_TYPE(META_DATA_TYPE_ID)\
)
CreateArtifactState:create table ARTIFACT_STATE (\
	ARTIFACT_STATE_ID smallint not null,\
	ARTIFACT_STATE varchar(12) not null,\
	primary key(ARTIFACT_STATE_ID),\
	unique (ARTIFACT_STATE)\
)
CreateArtifactType:create table ARTIFACT_TYPE (\
	ARTIFACT_TYPE_ID smallint not null,\
	ARTIFACT_TYPE varchar(12) not null,\
	primary key(ARTIFACT_TYPE_ID),\
	unique (ARTIFACT_TYPE)\
)
CreateArtifactFlag:create table ARTIFACT_FLAG (\
	ARTIFACT_FLAG_ID smallint not null,\
	ARTIFACT_FLAG varchar(12) not null,\
	primary key(ARTIFACT_FLAG_ID),\
	unique (ARTIFACT_FLAG)\
)
CreateArtifact:create table ARTIFACT(\
	ARTIFACT_ID bigint generated by default as identity (start with 2000),\
	ARTIFACT_NAME varchar(255) not null,\
	ARTIFACT_STATE_ID smallint not null,\
	ARTIFACT_TYPE_ID smallint not null,\
	ARTIFACT_UNIQUE_ID varchar(255) not null,\
	CREATED_BY bigint not null,\
	CREATED_ON timestamp not null,\
	UPDATED_BY bigint not null,\
	UPDATED_ON timestamp not null,\
	primary key (ARTIFACT_ID),\
	unique (ARTIFACT_UNIQUE_ID),\
	foreign key (ARTIFACT_STATE_ID) references ARTIFACT_STATE (ARTIFACT_STATE_ID),\
	foreign key (ARTIFACT_TYPE_ID) references ARTIFACT_TYPE (ARTIFACT_TYPE_ID),\
	foreign key (CREATED_BY) references USER(USER_ID),\
	foreign key (UPDATED_BY) references USER(USER_ID)\
)
CreateArtifactFlagRel:create table ARTIFACT_FLAG_REL (\
	ARTIFACT_ID bigint not null,\
	ARTIFACT_FLAG_ID smallint not null,\
	primary key (ARTIFACT_ID, ARTIFACT_FLAG_ID),\
	foreign key (ARTIFACT_ID) references ARTIFACT (ARTIFACT_ID),\
	foreign key (ARTIFACT_FLAG_ID) references ARTIFACT_FLAG (ARTIFACT_FLAG_ID)\
)
CreateArtifactTeamRel:create table ARTIFACT_TEAM_REL (\
	ARTIFACT_ID bigint not null,\
	USER_ID bigint not null,\
	primary key (ARTIFACT_ID, USER_ID),\
	foreign key (ARTIFACT_ID) references ARTIFACT (ARTIFACT_ID),\
	foreign key (USER_ID) references USER (USER_ID)\
)
CreateArtifactRemoteInfo:create table ARTIFACT_REMOTE_INFO (\
	ARTIFACT_ID bigint not null,\
	UPDATED_BY varchar(32) not null,\
	UPDATED_ON timestamp not null,\
	primary key(ARTIFACT_ID),\
	foreign key (ARTIFACT_ID) references ARTIFACT (ARTIFACT_ID)\
)
CreateArtifactVersion:create table ARTIFACT_VERSION (\
	ARTIFACT_ID bigint not null,\
	ARTIFACT_VERSION_ID bigint not null,\
	ARTIFACT_NAME varchar(255) not null,\
	ARTIFACT_TYPE varchar(12) not null,\
	ARTIFACT_UNIQUE_ID varchar(255) not null,\
	COMMENT varchar(128) default null,\
	CREATED_BY  bigint not null,\
	CREATED_ON timestamp not null,\
	UPDATED_BY  bigint not null,\
	UPDATED_ON timestamp not null,\
	primary key (ARTIFACT_ID, ARTIFACT_VERSION_ID),\
	foreign key (ARTIFACT_ID) references ARTIFACT (ARTIFACT_ID),\
	foreign key (ARTIFACT_UNIQUE_ID) references ARTIFACT (ARTIFACT_UNIQUE_ID),\
	foreign key (CREATED_BY) references USER(USER_ID),\
	foreign key (UPDATED_BY) references USER(USER_ID)\
)
CreateArtifactVersionMetaData:create table ARTIFACT_VERSION_META_DATA (\
	ARTIFACT_ID bigint not null,\
	ARTIFACT_VERSION_ID bigint not null,\
	ARTIFACT_VERSION_META_DATA_TYPE_ID smallint not null,\
	KEY varchar(64) not null,\
	VALUE varchar(255) not null,\
	primary key (ARTIFACT_ID,ARTIFACT_VERSION_ID,KEY),\
	foreign key (ARTIFACT_ID,ARTIFACT_VERSION_ID) references ARTIFACT_VERSION(ARTIFACT_ID,ARTIFACT_VERSION_ID),\
	foreign key (ARTIFACT_VERSION_META_DATA_TYPE_ID) references META_DATA_TYPE(META_DATA_TYPE_ID)\
)
CreateArtifactAuditType:create table ARTIFACT_AUDIT_TYPE (\
	ARTIFACT_AUDIT_TYPE_ID smallint not null,\
	ARTIFACT_AUDIT_TYPE varchar(12) not null,\
	primary key (ARTIFACT_AUDIT_TYPE_ID),\
	unique (ARTIFACT_AUDIT_TYPE)\
)
CreateArtifactAudit:create table ARTIFACT_AUDIT (\
	ARTIFACT_AUDIT_ID bigint generated by default as identity (start with 3000),\
	ARTIFACT_AUDIT_TYPE_ID smallint not null,\
	ARTIFACT_ID bigint not null,\
	CREATED_ON timestamp not null,\
	CREATED_BY bigint not null,\
	primary key (ARTIFACT_AUDIT_ID),\
	foreign key (ARTIFACT_AUDIT_TYPE_ID) references ARTIFACT_AUDIT_TYPE(ARTIFACT_AUDIT_TYPE_ID),\
	foreign key (ARTIFACT_ID) references ARTIFACT(ARTIFACT_ID),\
	foreign key (CREATED_BY) references USER(USER_ID)\
)
CreateArtifactAuditMetaData:create table ARTIFACT_AUDIT_META_DATA (\
	ARTIFACT_AUDIT_ID bigint not null,\
	META_DATA_ID bigint not null,\
	foreign key (ARTIFACT_AUDIT_ID) references ARTIFACT_AUDIT(ARTIFACT_AUDIT_ID),\
	foreign key (META_DATA_ID) references META_DATA(META_DATA_ID)\
)
CreateArtifactAuditVersion:create table ARTIFACT_AUDIT_VERSION (\
	ARTIFACT_AUDIT_ID bigint not null,\
	ARTIFACT_ID bigint not null,\
	ARTIFACT_VERSION_ID bigint not null,\
	primary key (ARTIFACT_AUDIT_ID),\
	foreign key (ARTIFACT_AUDIT_ID) references ARTIFACT_AUDIT(ARTIFACT_AUDIT_ID),\
	foreign key (ARTIFACT_ID,ARTIFACT_VERSION_ID) references ARTIFACT_VERSION(ARTIFACT_ID,ARTIFACT_VERSION_ID)\
)
CreateConfiguration:create table CONFIGURATION (\
	CONFIGURATION_KEY varchar(12) not null,\
	META_DATA_ID bigint not null,\
	foreign key (META_DATA_ID) references META_DATA(META_DATA_ID),\
	primary key (CONFIGURATION_KEY)\
)
CreateContainer:create table CONTAINER(\
	CONTAINER_ID bigint not null,\
	primary key (CONTAINER_ID),\
	foreign key (CONTAINER_ID) references ARTIFACT (ARTIFACT_ID)\
)
CreateContainerDraft:create table CONTAINER_DRAFT (\
	CONTAINER_DRAFT_ID bigint not null,\
	CONTAINER_DRAFT_USER_ID bigint not null,\
	primary key (CONTAINER_DRAFT_ID),\
	foreign key (CONTAINER_DRAFT_ID,CONTAINER_DRAFT_USER_ID) references ARTIFACT_TEAM_REL (ARTIFACT_ID,USER_ID),\
	foreign key (CONTAINER_DRAFT_ID) references CONTAINER (CONTAINER_ID),\
	foreign key (CONTAINER_DRAFT_USER_ID) references USER (USER_ID)\
)
CreateContainerDraftArtifactRel:create table CONTAINER_DRAFT_ARTIFACT_REL (\
	CONTAINER_DRAFT_ID bigint not null,\
	ARTIFACT_ID bigint not null,\
	ARTIFACT_STATE varchar(12) not null,\
	primary key (CONTAINER_DRAFT_ID,ARTIFACT_ID),\
	foreign key (CONTAINER_DRAFT_ID) references CONTAINER_DRAFT (CONTAINER_DRAFT_ID),\
	foreign key (ARTIFACT_ID) references ARTIFACT (ARTIFACT_ID)\
)
CreateContainerVersion:create table CONTAINER_VERSION (\
	CONTAINER_ID bigint not null,\
	CONTAINER_VERSION_ID bigint not null,\
	primary key (CONTAINER_ID,CONTAINER_VERSION_ID),\
	foreign key (CONTAINER_ID, CONTAINER_VERSION_ID) references ARTIFACT_VERSION (ARTIFACT_ID, ARTIFACT_VERSION_ID)\
)
CreateContainerVersionArtifactVersionRel:create table CONTAINER_VERSION_ARTIFACT_VERSION_REL (\
	CONTAINER_ID bigint not null,\
	CONTAINER_VERSION_ID bigint not null,\
	ARTIFACT_ID bigint not null,\
	ARTIFACT_VERSION_ID bigint not null,\
	ARTIFACT_TYPE_ID smallint not null,\
	primary key (CONTAINER_ID,CONTAINER_VERSION_ID,ARTIFACT_ID,ARTIFACT_VERSION_ID),\
	foreign key (CONTAINER_ID,CONTAINER_VERSION_ID) references CONTAINER_VERSION (CONTAINER_ID,CONTAINER_VERSION_ID),\
	foreign key (ARTIFACT_ID,ARTIFACT_VERSION_ID) references ARTIFACT_VERSION (ARTIFACT_ID,ARTIFACT_VERSION_ID),\
	foreign key (ARTIFACT_TYPE_ID) references ARTIFACT_TYPE (ARTIFACT_TYPE_ID)\
)
CreateContainerVersionDelta:create table CONTAINER_VERSION_DELTA (\
	CONTAINER_VERSION_DELTA_ID  bigint generated by default as identity (start with 4000),\
	CONTAINER_ID bigint not null,\
	COMPARE_CONTAINER_VERSION_ID bigint not null,\
	COMPARE_TO_CONTAINER_VERSION_ID bigint not null,\
	primary key (CONTAINER_VERSION_DELTA_ID),\
	unique (CONTAINER_ID,COMPARE_CONTAINER_VERSION_ID,COMPARE_TO_CONTAINER_VERSION_ID),\
	foreign key (CONTAINER_ID,COMPARE_CONTAINER_VERSION_ID) references CONTAINER_VERSION(CONTAINER_ID,CONTAINER_VERSION_ID),\
	foreign key (CONTAINER_ID,COMPARE_TO_CONTAINER_VERSION_ID) references CONTAINER_VERSION(CONTAINER_ID,CONTAINER_VERSION_ID)\
)
CreateContainerVersionArtifactVersionDelta:create table CONTAINER_VERSION_ARTIFACT_VERSION_DELTA(\
	CONTAINER_VERSION_DELTA_ID bigint not null,\
	DELTA varchar(8) not null,\
	DELTA_ARTIFACT_ID bigint not null,\
	DELTA_ARTIFACT_VERSION_ID bigint not null,\
	primary key(CONTAINER_VERSION_DELTA_ID,DELTA_ARTIFACT_ID,DELTA_ARTIFACT_VERSION_ID),\
	foreign key(DELTA_ARTIFACT_ID,DELTA_ARTIFACT_VERSION_ID) references ARTIFACT_VERSION(ARTIFACT_ID,ARTIFACT_VERSION_ID)\
)
CreateContainerVersionPublishedTo:create table CONTAINER_VERSION_PUBLISHED_TO (\
	CONTAINER_ID bigint not null,\
	CONTAINER_VERSION_ID bigint not null,\
	USER_ID bigint not null,\
	RECEIVED_ON timestamp,\
	primary key (CONTAINER_ID,CONTAINER_VERSION_ID,USER_ID),\
	foreign key (CONTAINER_ID,CONTAINER_VERSION_ID) references CONTAINER_VERSION (CONTAINER_ID,CONTAINER_VERSION_ID),\
	foreign key (USER_ID) references USER (USER_ID)\
)
CreateDocument:create table DOCUMENT (\
	DOCUMENT_ID bigint not null,\
	primary key (DOCUMENT_ID),\
	foreign key (DOCUMENT_ID) references ARTIFACT (ARTIFACT_ID)\
)
CreateDocumentVersion:create table DOCUMENT_VERSION (\
	DOCUMENT_ID bigint not null,\
	DOCUMENT_VERSION_ID bigint not null,\
	CONTENT longvarbinary not null,\
	CONTENT_SIZE bigint not null,\
	CONTENT_ENCODING varchar(255) not null,\
	CONTENT_CHECKSUM varchar(255) not null,\
	CONTENT_COMPRESSION smallint not null,\
	primary key (DOCUMENT_ID, DOCUMENT_VERSION_ID),\
	foreign key (DOCUMENT_ID, DOCUMENT_VERSION_ID) references ARTIFACT_VERSION (ARTIFACT_ID, ARTIFACT_VERSION_ID)\
)
CreateEmail:create table EMAIL(\
	EMAIL_ID bigint generated by default as identity (start with 5000),\
	EMAIL varchar not null,\
	primary key (EMAIL_ID),\
	unique (EMAIL)\
)
CreateSystemMessageType:create table SYSTEM_MESSAGE_TYPE (\
	SYSTEM_MESSAGE_TYPE_ID smallint not null,\
	SYSTEM_MESSAGE_TYPE varchar(12) not null,\
	primary key (SYSTEM_MESSAGE_TYPE_ID),\
	unique (SYSTEM_MESSAGE_TYPE)\
)
CreateSystemMessage:create table SYSTEM_MESSAGE (\
	SYSTEM_MESSAGE_ID bigint generated by default as identity (start with 6000),\
	SYSTEM_MESSAGE_TYPE_ID smallint not null,\
	primary key(SYSTEM_MESSAGE_ID),\
	foreign key(SYSTEM_MESSAGE_TYPE_ID) references SYSTEM_MESSAGE_TYPE(SYSTEM_MESSAGE_TYPE_ID)\
)
CreateSystemMessageMetaData:create table SYSTEM_MESSAGE_META_DATA (\
	SYSTEM_MESSAGE_ID bigint not null,\
	META_DATA_ID bigint not null,\
	primary key (SYSTEM_MESSAGE_ID,META_DATA_ID),\
	foreign key (SYSTEM_MESSAGE_ID) references SYSTEM_MESSAGE(SYSTEM_MESSAGE_ID),\
	foreign key (META_DATA_ID) references META_DATA(META_DATA_ID)\
)
CreateUser:create table USER (\
    USER_ID bigint generated by default as identity (start with 7000),\
    JABBER_ID varchar not null,\
    NAME varchar not null,\
    ORGANIZATION varchar,\
    TITLE varchar,\
    primary key (USER_ID),\
    unique (JABBER_ID)\
)
CreateProfile:create table PROFILE (\
	PROFILE_ID bigint not null,\
	PROFILE_VCARD varchar,\
	primary key (PROFILE_ID),\
	foreign key (PROFILE_ID) references USER (USER_ID)\
)
CreateProfileEmailRel:create table PROFILE_EMAIL_REL (\
	PROFILE_ID bigint not null,\
	EMAIL_ID bigint not null,\
	VERIFIED boolean not null,\
	primary key (PROFILE_ID,EMAIL_ID),\
	foreign key (PROFILE_ID) references USER (USER_ID),\
	foreign key (EMAIL_ID) references EMAIL (EMAIL_ID)\
)
CreateContact:create table CONTACT (\
	CONTACT_ID bigint not null,\
	CONTACT_VCARD varchar,\
	primary key (CONTACT_ID),\
	foreign key (CONTACT_ID) references USER(USER_ID)\
)
CreateContactEmailRel:create table CONTACT_EMAIL_REL (\
	CONTACT_ID bigint not null,\
	EMAIL_ID bigint not null,\
	primary key (CONTACT_ID,EMAIL_ID),\
	foreign key (CONTACT_ID) references CONTACT (CONTACT_ID),\
	foreign key (EMAIL_ID) references EMAIL (EMAIL_ID)\
)
CreateContactInvitation:create table CONTACT_INVITATION (\
	CONTACT_INVITATION_ID bigint generated by default as identity (start with 8000),\
	CREATED_ON timestamp not null,\
	CREATED_BY bigint not null,\
	primary key (CONTACT_INVITATION_ID),\
	foreign key (CREATED_BY) references USER (USER_ID)\
)
CreateContactInvitationIncoming:create table CONTACT_INVITATION_INCOMING (\
	CONTACT_INVITATION_ID bigint not null,\
	INVITED_AS bigint not null,\
	INVITED_BY bigint not null,\
	primary key (CONTACT_INVITATION_ID),\
	unique (INVITED_BY),\
	foreign key (CONTACT_INVITATION_ID) references CONTACT_INVITATION (CONTACT_INVITATION_ID),\
	foreign key (INVITED_AS) references EMAIL (EMAIL_ID),\
	foreign key (INVITED_BY) references USER (USER_ID)\
)
CreateContactInvitationOutgoing:create table CONTACT_INVITATION_OUTGOING (\
	CONTACT_INVITATION_ID bigint not null,\
	EMAIL_ID bigint not null,\
	primary key (CONTACT_INVITATION_ID),\
	unique (EMAIL_ID),\
	foreign key (CONTACT_INVITATION_ID) references CONTACT_INVITATION (CONTACT_INVITATION_ID),\
	foreign key (EMAIL_ID) references EMAIL (EMAIL_ID)\
)
################################################################################

################################################################################
## Indicies
################################################################################
CreateIndexUserName:create index USER_NAME on USER (NAME)
CreateIndexUserOrganization:create index USER_ORGANIZATION on USER (ORGANIZATION)
CreateIndexEmail:create index EMAIL_EMAIL on EMAIL (EMAIL)

################################################################################
## Seed Data
################################################################################
InsertSeedMetaDataType:insert into \
	META_DATA_TYPE (META_DATA_TYPE_ID,META_DATA_TYPE)\
	values (?,?)
InsertSeedVersion:insert into \
	META_DATA (META_DATA_TYPE_ID,KEY,VALUE)\
	values (?,?,?)
InsertSeedArtifactState:insert into \
	ARTIFACT_STATE (ARTIFACT_STATE_ID,ARTIFACT_STATE)\
	values (?,?)
InsertSeedArtifactType:insert into \
	ARTIFACT_TYPE (ARTIFACT_TYPE_ID,ARTIFACT_TYPE)\
	values (?,?)
InsertSeedArtifactFlag:insert into \
	ARTIFACT_FLAG (ARTIFACT_FLAG_ID,ARTIFACT_FLAG)\
	values (?,?)
InsertSeedArtifactAuditType:insert into \
	ARTIFACT_AUDIT_TYPE (ARTIFACT_AUDIT_TYPE_ID,ARTIFACT_AUDIT_TYPE)\
	values (?,?)
InsertSeedSystemMessageType:insert into \
	SYSTEM_MESSAGE_TYPE (SYSTEM_MESSAGE_TYPE_ID,SYSTEM_MESSAGE_TYPE)\
	values (?,?)
ReadMetaDataReleaseId:select VALUE \
	from META_DATA \
	where META_DATA_ID=? and META_DATA_TYPE_ID=? and KEY=?
################################################################################
